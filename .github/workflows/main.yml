name: CI/CD Pipeline

on:
  push:
    branches: [ main, development ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Run custom tests
      run: |
        if [ -f "run_tests.sh" ]; then
          echo "Setting execute permissions for test script..."
          chmod +x run_tests.sh
          echo "Running custom test suite..."
          ./run_tests.sh
        else
          echo "No test script found - skipping tests"
        fi

  build:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check project structure
      run: |
        echo "Project contents:"
        ls -la
        echo ""
        echo "Looking for common project files..."
        [ -f "requirements.txt" ] && echo "Found: Python requirements.txt"
        [ -f "pom.xml" ] && echo "Found: Java Maven pom.xml"
        [ -f "build.gradle" ] && echo "Found: Java Gradle build.gradle"
        [ -f "go.mod" ] && echo "Found: Go mod file"
        [ -f "Cargo.toml" ] && echo "Found: Rust Cargo.toml"
        [ -f "package.json" ] && echo "Found: Node.js package.json"
        [ -f "composer.json" ] && echo "Found: PHP composer.json"
