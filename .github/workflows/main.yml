name: CI Pipeline with Documentation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Ð—ÐÐ”ÐÐ§Ð 1: Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• (Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ°Ðº Ð±Ñ‹Ð»Ð¾)
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Display project structure
      run: |
        echo "=== Project Structure ==="
        ls -la
        echo ""
        echo "=== File Details ==="
        find . -type f -name "*.py" -o -name "*.java" -o -name "*.js" -o -name "*.go" -o -name "*.rs" -o -name "*.php" | head -20
        
    - name: Run tests if test script exists
      run: |
        if [ -f "run_tests.sh" ]; then
          echo "Found run_tests.sh - making executable and running..."
          chmod +x run_tests.sh
          ./run_tests.sh
        else
          echo "No run_tests.sh found - this is OK"
        fi

  # Ð—ÐÐ”ÐÐ§Ð 2: Ð”ÐžÐšÐ£ÐœÐ•ÐÐ¢ÐÐ¦Ð˜Ð¯ (ÐÐžÐ’ÐÐ¯!) 
  generate-docs:
    runs-on: ubuntu-latest
    name: Generate Documentation
    needs: test  # Ð–Ð´ÐµÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²
    
    steps:
    # Ð¨Ð°Ð³ 1: Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ ÐºÐ¾Ð´
    - name: Checkout code
      uses: actions/checkout@v4
      
    # Ð¨Ð°Ð³ 2: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ
    - name: Create basic documentation
      run: |
        echo "ðŸ“š Starting documentation generation..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸
        cat > README_AUTO.md << 'EOF'
        # ðŸš€ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
        
        ## Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÑÐ±Ð¾Ñ€ÐºÐµ
        - **Ð’ÐµÑ‚ÐºÐ°**: ${{ github.ref }}
        - **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚**: ${{ github.sha }}
        - **Ð”Ð°Ñ‚Ð° ÑÐ±Ð¾Ñ€ÐºÐ¸**: $(date)
        - **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾
        
        ## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
        EOF
        
        echo "âœ… ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ„Ð°Ð¹Ð» Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½!"
        
    # Ð¨Ð°Ð³ 3: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ
    - name: Add file structure to docs
      run: |
        echo "" >> README_AUTO.md
        echo "### Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²:" >> README_AUTO.md
        echo '```' >> README_AUTO.md
        find . -type f -name "*.py" -o -name "*.java" -o -name "*.js" -o -name "*.go" -o -name "*.rs" -o -name "*.php" | head -15 >> README_AUTO.md
        echo '```' >> README_AUTO.md
        
    # Ð¨Ð°Ð³ 4: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð°Ñ…
    - name: Create test report section
      run: |
        echo "" >> README_AUTO.md
        echo "## ðŸ“Š ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸" >> README_AUTO.md
        echo "Ð¢ÐµÑÑ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹: âœ… Ð£Ð¡ÐŸÐ•Ð¨ÐÐž" >> README_AUTO.md
        echo "Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: $(date)" >> README_AUTO.md
        echo "Ð’ÐµÑ‚ÐºÐ°: ${{ github.ref }}" >> README_AUTO.md
        
    # Ð¨Ð°Ð³ 5: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑŽ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²
    - name: Create developer guide
      run: |
        echo "" >> README_AUTO.md
        echo "## ðŸ‘¨â€ðŸ’» Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°" >> README_AUTO.md
        echo "### ÐšÐ°Ðº Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚:" >> README_AUTO.md
        echo '```bash' >> README_AUTO.md
        echo "# ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹" >> README_AUTO.md
        echo "git clone https://github.com/${{ github.repository }}.git" >> README_AUTO.md
        echo "cd $(basename ${{ github.repository }})" >> README_AUTO.md
        echo "" >> README_AUTO.md
        
        # ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ñ‚Ð¸Ð¿ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
        if [ -f "package.json" ]; then
          echo "# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Node.js" >> README_AUTO.md
          echo "npm install" >> README_AUTO.md
        elif [ -f "requirements.txt" ]; then
          echo "# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Python" >> README_AUTO.md
          echo "pip install -r requirements.txt" >> README_AUTO.md
        fi
        
        echo "# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹" >> README_AUTO.md
        echo "./run_tests.sh" >> README_AUTO.md
        echo '```' >> README_AUTO.md
        
    # Ð¨Ð°Ð³ 6: Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ ÐºÐ°Ðº Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚
    - name: Upload documentation artifact
      uses: actions/upload-artifact@v4
      with:
        name: auto-documentation
        path: README_AUTO.md
        retention-days: 30
        
    # Ð¨Ð°Ð³ 7: ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
    - name: Show documentation preview
      run: |
        echo "ðŸŽ‰ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°!"
        echo "=== ÐŸÑ€ÐµÐ²ÑŒÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ ==="
        head -20 README_AUTO.md

  # Ð—ÐÐ”ÐÐ§Ð 3: Ð¤Ð˜ÐÐÐ›Ð¬ÐÐ«Ð™ ÐžÐ¢Ð§Ð•Ð¢ (ÐÐžÐ’ÐÐ¯!)
  final-report:
    runs-on: ubuntu-latest
    name: Final Lab Report
    needs: [test, generate-docs]  # Ð–Ð´ÐµÑ‚ Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ
    
    steps:
    - name: Generate lab completion report
      run: |
        echo "ðŸ Ð›ÐÐ‘ÐžÐ ÐÐ¢ÐžÐ ÐÐÐ¯ Ð ÐÐ‘ÐžÐ¢Ð Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ" 
        echo "=========================================="
        echo "ðŸ“… Ð”Ð°Ñ‚Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ: $(date)"
        echo "ðŸ“ Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹: ${{ github.repository }}"
        echo "ðŸŒ¿ Ð’ÐµÑ‚ÐºÐ°: ${{ github.ref }}"
        echo "ðŸ”— ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚: ${{ github.sha }}"
        echo ""
        echo "âœ… Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐÐ«Ð• Ð—ÐÐ”ÐÐ§Ð˜:"
        echo "----------------------"
        echo "1. âœ… ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½ CI Pipeline"
        echo "2. âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ" 
        echo "3. âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸"
        echo "4. âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸"
        echo "5. âœ… Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹"
        echo ""
        echo "ðŸ“Š Ð¡Ð¢ÐÐ¢Ð£Ð¡: Ð’Ð¡Ð• Ð—ÐÐ”ÐÐ§Ð˜ Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ« Ð£Ð¡ÐŸÐ•Ð¨ÐÐž"
        echo ""
        echo "ðŸŽ¯ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Actions â†’ Artifacts"
        
    - name: Create completion badge
      run: |
        echo "ðŸŸ¢ STATUS: LAB COMPLETED SUCCESSFULLY" > lab-status.txt
        echo "Timestamp: $(date)" >> lab-status.txt
